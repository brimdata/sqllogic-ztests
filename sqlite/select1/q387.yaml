script: |
  super -f text -I q387.spq > q387.out

inputs:
  - name: q387.spq
    data: |
      SELECT a,
      b,
      abs(a),
      CASE WHEN c>(SELECT avg(c) FROM t1 (FORMAT parquet)) THEN a*2 ELSE b*10 END
      FROM t1 (FORMAT parquet)
      WHERE (c<=d-2 OR c>=d+2)
      OR a>b
      ORDER BY 2,3,4,1;
  - name: t1

outputs:
  - name: q387.out
    data: |
      104	100	104	1000
      107	105	107	1050
      115	118	115	1180
      127	129	127	1290
      131	130	131	1300
      149	145	149	1450
      153	151	153	1510
      159	158	159	1580
      163	160	163	1600
      168	167	168	1670
      174	170	174	1700
      179	175	179	358
      182	181	182	364
      188	186	188	376
      191	194	191	382
      199	198	199	398
      201	200	201	402
      213	211	213	426
      216	218	216	432
      220	223	220	440
      229	228	229	458
      234	232	234	468
      239	236	239	478
      243	240	243	486
