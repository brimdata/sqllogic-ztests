# Failed due to: https://github.com/brimdata/super/issues/6013
script: |
  super -f tsv -I q970.sql | sort > q970.out

inputs:
  - name: q970.sql
    data: |
      SELECT CASE WHEN a<b-3 THEN 111 WHEN a<=b THEN 222
      WHEN a<b+3 THEN 333 ELSE 444 END,
      (SELECT count(*) FROM t1 AS x WHERE x.c>t1.c AND x.d<t1.d),
      abs(a),
      a+b*2,
      a-b,
      CASE WHEN c>(SELECT avg(c) FROM t1) THEN a*2 ELSE b*10 END,
      d-e
      FROM t1;
  - name: t1

outputs:
  - name: q970.out
    data: |
      111	0	245	743	-4	490	2
      222	0	121	369	-3	1240	NULL
      222	0	127	385	-2	1290	2
      222	0	138	416	-1	1390	1
      222	0	142	428	-1	1430	-4
      222	0	191	579	-3	382	-2
      222	0	216	652	-2	432	-2
      222	0	220	666	-3	440	1
      333	0	107	317	2	1050	-1
      333	0	131	391	1	1300	1
      333	0	153	455	2	1510	NULL
      333	0	159	475	1	1580	NULL
      333	0	168	502	1	1670	NULL
      333	0	182	544	1	364	3
      333	0	188	560	2	376	-4
      333	0	199	595	1	398	-1
      333	0	213	635	2	426	2
      333	0	229	685	1	458	-1
      333	0	234	698	2	468	3
      444	0	104	NULL	NULL	NULL	NULL
      444	0	115	NULL	NULL	NULL	-1
      444	0	149	439	4	1450	NULL
      444	0	163	483	3	1600	2
      444	0	174	514	4	1700	-2
      444	0	179	529	4	358	NULL
      444	0	201	NULL	NULL	402	-1
      444	0	239	711	3	2360	1
      444	0	243	723	3	486	NULL
      444	0	NULL	NULL	NULL	1120	4
      444	0	NULL	NULL	NULL	NULL	NULL
