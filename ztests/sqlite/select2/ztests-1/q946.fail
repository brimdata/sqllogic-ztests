# Failed due to: https://github.com/brimdata/super/issues/6549
script: |
  super -f tsv -I q946.sql | sort > q946.out

vector: true

inputs:
  - name: q946.sql
    data: |
      SELECT a+b*2+c*3,
      b,
      CASE WHEN c>(SELECT avg(c) FROM t1) THEN a*2 ELSE b*10 END,
      (SELECT count(*) FROM t1 AS x WHERE x.b<t1.b),
      (a+b+c+d+e)/5,
      a,
      d
      FROM t1;
  - name: t1

outputs:
  - name: q946.out
    data: |
      1000	167	1670	11	NULL	168	NULL
      1030	170	1700	12	172	174	171
      1057	175	358	13	NULL	179	NULL
      1096	181	364	14	182	182	183
      1121	186	376	15	187	188	185
      1158	194	382	16	192	191	190
      1180	198	398	17	197	199	196
      1277	211	426	19	212	213	212
      1297	218	432	20	217	216	217
      1338	223	440	21	222	220	222
      1360	228	458	22	227	229	226
      1391	232	468	23	232	234	233
      1455	240	486	25	NULL	243	NULL
      1484	249	490	26	247	245	248
      635	105	1050	0	107	107	108
      738	124	1240	2	NULL	121	122
      760	129	1290	3	127	127	128
      793	130	1300	4	132	131	133
      827	139	1390	5	137	138	136
      851	143	1430	6	142	142	140
      880	145	1450	7	NULL	149	NULL
      905	151	1510	8	NULL	153	NULL
      940	158	1580	9	NULL	159	NULL
      966	160	1600	10	162	163	164
      NULL	112	1120	1	NULL	NULL	114
      NULL	206	NULL	18	NULL	NULL	207
      NULL	236	2360	24	NULL	239	238
      NULL	NULL	402	0	NULL	201	203
      NULL	NULL	NULL	0	NULL	104	101
      NULL	NULL	NULL	0	NULL	115	116
