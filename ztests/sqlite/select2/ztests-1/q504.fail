# Failed due to: https://github.com/brimdata/super/issues/6013
script: |
  super -f tsv -I q504.sql | sort > q504.out

inputs:
  - name: q504.sql
    data: |
      SELECT CASE WHEN c>(SELECT avg(c) FROM t1) THEN a*2 ELSE b*10 END,
      (SELECT count(*) FROM t1 AS x WHERE x.c>t1.c AND x.d<t1.d),
      CASE WHEN a<b-3 THEN 111 WHEN a<=b THEN 222
      WHEN a<b+3 THEN 333 ELSE 444 END,
      a
      FROM t1;
  - name: t1

outputs:
  - name: q504.out
    data: |
      1050	0	333	107
      1120	0	444	NULL
      1240	0	222	121
      1290	0	222	127
      1300	0	333	131
      1390	0	222	138
      1430	0	222	142
      1450	0	444	149
      1510	0	333	153
      1580	0	333	159
      1600	0	444	163
      1670	0	333	168
      1700	0	444	174
      2360	0	444	239
      358	0	444	179
      364	0	333	182
      376	0	333	188
      382	0	222	191
      398	0	333	199
      402	0	444	201
      426	0	333	213
      432	0	222	216
      440	0	222	220
      458	0	333	229
      468	0	333	234
      486	0	444	243
      490	0	111	245
      NULL	0	444	104
      NULL	0	444	115
      NULL	0	444	NULL
