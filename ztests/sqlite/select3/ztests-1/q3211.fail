# Failed due to: https://github.com/brimdata/super/issues/6013
script: |
  super -f tsv -I q3211.sql | sort > q3211.out

inputs:
  - name: q3211.sql
    data: |
      SELECT d-e,
      CASE WHEN c>(SELECT avg(c) FROM t1) THEN a*2 ELSE b*10 END,
      b,
      a,
      c,
      (SELECT count(*) FROM t1 AS x WHERE x.b<t1.b),
      abs(a)
      FROM t1
      ORDER BY 2,7;

outputs:
  - name: q3211.out
    data: |
      -1	1050	105	107	106	0	107
      -1	398	198	199	195	17	199
      -1	402	NULL	201	202	0	201
      -1	458	228	229	225	22	229
      -1	NULL	NULL	115	119	0	115
      -2	1700	170	174	172	12	174
      -2	382	194	191	193	16	191
      -2	432	218	216	215	20	216
      -4	1430	143	142	141	6	142
      -4	376	186	188	187	15	188
      1	1300	130	131	134	4	131
      1	1390	139	138	137	5	138
      1	2360	236	239	NULL	24	239
      1	440	223	220	224	21	220
      2	1290	129	127	125	3	127
      2	1600	160	163	161	10	163
      2	426	211	213	214	19	213
      2	490	249	245	247	26	245
      3	364	181	182	184	14	182
      3	468	232	234	231	23	234
      4	1120	112	NULL	113	1	NULL
      NULL	1240	124	121	123	2	121
      NULL	1450	145	149	147	7	149
      NULL	1510	151	153	150	8	153
      NULL	1580	158	159	155	9	159
      NULL	1670	167	168	166	11	168
      NULL	358	175	179	176	13	179
      NULL	486	240	243	244	25	243
      NULL	NULL	206	NULL	208	18	NULL
      NULL	NULL	NULL	104	102	0	104
