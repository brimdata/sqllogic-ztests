# Failed due to: https://github.com/brimdata/super/issues/6013
script: |
  super -f tsv -I q858.sql > q858.out

inputs:
  - name: q858.sql
    data: |
      SELECT abs(b-c),
      a+b*2,
      CASE WHEN c>(SELECT avg(c) FROM t1) THEN a*2 ELSE b*10 END,
      CASE WHEN a<b-3 THEN 111 WHEN a<=b THEN 222
      WHEN a<b+3 THEN 333 ELSE 444 END,
      (SELECT count(*) FROM t1 AS x WHERE x.b<t1.b)
      FROM t1
      ORDER BY 2,3,1,4,5;
  - name: t1

outputs:
  - name: q858.out
    data: |
      2	304	1000	444	0
      1	317	1050	333	1
      1	335	1120	222	2
      1	351	1180	222	3
      1	369	1240	222	4
      4	385	1290	222	5
      4	391	1300	333	6
      2	416	1390	222	7
      2	428	1430	222	8
      2	439	1450	444	9
      1	455	1510	333	10
      3	475	1580	333	11
      1	483	1600	444	12
      1	502	1670	333	13
      2	514	1700	444	14
      1	529	358	444	15
      3	544	364	333	16
      1	560	376	333	17
      1	579	382	222	18
      3	595	398	333	19
      2	601	402	333	20
      2	617	410	222	21
      3	635	426	333	22
      3	652	432	222	23
      1	666	440	222	24
      3	685	458	333	25
      1	698	468	333	26
      1	711	478	444	27
      4	723	486	444	28
      2	743	490	111	29
